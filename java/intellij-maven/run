#!/usr/bin/env bash

function delayedPluginInstall {
    sudo mkdir -p /home/dev/.IdeaIC2016.2/config/plugins
    sudo mkdir -p /home/dev/.IdeaIC2016.2/config/options
    sudo chown dev:dev -R /home/dev/.IdeaIC2016.2

    cd /home/dev/.IdeaIC2016.2/config/plugins/

    #echo 'Installing Go plugin'
    #wget https://plugins.jetbrains.com/files/5047/27278/Go-0.12.1724.zip -O go.zip -q && unzip -q go.zip && rm go.zip

    # echo 'Installing Markdown support plugin'
    # wget https://plugins.jetbrains.com/files/7793/25156/markdown-2016.1.20160405.zip -O markdown.zip -q && unzip -q markdown.zip && rm markdown.zip

    # # Adding the predefined preferences to IDEA
    # cp /home/dev/.jdk.table.xml /home/dev/.IdeaIC2016.2/config/options/jdk.table.xml
}

if [ ! -d /home/dev/.IdeaIC2016.2/config/plugins/Go ]; then
    # We are running with a non-Docker contained volume for IntelliJ prefs so we need to setup the plugin again
    delayedPluginInstall
fi

if [ -d /home/dev/.IdeaIC2016.2 ]; then
    # Ensure proper permissions
    sudo chown dev:dev -R /home/dev/.IdeaIC2016.2
fi

exec /opt/intellij/bin/idea.sh
